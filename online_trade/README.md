# 在线交易系统

基于成交量突破策略的自动化加密货币交易系统。

## 🌟 系统特性

### 📊 数据管理
- **自动数据拉取**: 每小时自动拉取最新的15分钟K线数据
- **数据存储优化**: 每个币种单独文件，避免文件碎片化
- **增量更新**: 只拉取新数据，避免重复下载

### ⚡ 交易策略
- **成交量突破策略**: 基于4小时周期的成交量突破检测
- **黄金分割点买入**: 智能挂单系统，提高买入性价比
- **多重过滤条件**: 
  - 成交额是过去一周的5倍以上
  - 价格上升且涨幅小于20%
  - 必须处于盘整阶段后

### 🛡️ 风险管理
- **自动止损**: -8% 强制止损
- **动态止盈**: 15% 固定止盈
- **仓位控制**: 单仓位不超过15%，总仓位不超过80%
- **滑点控制**: 默认控制在0.1%以内，使用限价单替代市价单
- **实时监控**: 每30分钟检查一次风险状态

## 📁 系统架构

```
online_trade/
├── data_fetcher.py           # 数据拉取器
├── enhanced_trader.py        # 增强版交易器
├── online_strategy_engine.py # 在线策略引擎
├── start_online_trading.py   # 系统启动器
└── README.md                # 说明文档
```

### 🔧 组件说明

#### 1. 数据拉取器 (data_fetcher.py)
- **功能**: 定时拉取币安现货数据
- **频率**: 每小时执行一次
- **数据源**: 从 `online_data/exchange_binance_market.txt` 读取币种列表
- **存储位置**: `online_data/spot_klines/`

#### 2. 增强版交易器 (enhanced_trader.py)
- **功能**: 执行实际的买卖操作
- **API集成**: 复用 `trade/mm_trader.py` 的币安API逻辑
- **风险控制**: 内置止盈止损和仓位管理

#### 3. 在线策略引擎 (online_strategy_engine.py)
- **功能**: 复用 `volume_breakout_strategy.py` 的信号检测逻辑
- **交易周期**: 每4小时执行一次信号检测和交易
- **策略执行**: 集成数据分析、信号检测、交易执行

#### 4. 系统启动器 (start_online_trading.py)
- **功能**: 统一管理整个系统的启动和监控
- **多线程**: 并行运行数据拉取器和策略引擎
- **状态监控**: 实时监控系统运行状态

## 🚀 使用方法

### 环境准备

1. **安装依赖包**:
```bash
pip install pandas numpy requests pytz schedule
```

2. **配置API密钥**:
确保 `online_data/config/config.json` 文件存在并包含有效的币安API密钥：
```json
{
    "api_key": "your_binance_api_key",
    "api_secret": "your_binance_api_secret",
    "proxy_host": null,
    "proxy_port": null
}
```

3. **准备币种列表**:
确保 `online_data/exchange_binance_market.txt` 文件存在并包含要交易的币种列表。

### 启动方式

#### 1. 完整系统启动（推荐）
```bash
cd online_trade
# 基础启动（滑点控制0.1%）
python start_online_trading.py --capital 1000 --buy-strategy golden_ratio

# 严格滑点控制（0.05%）
python start_online_trading.py --capital 1000 --buy-strategy golden_ratio --slippage-limit 0.0005

# 宽松滑点控制（0.2%）
python start_online_trading.py --capital 1000 --buy-strategy golden_ratio --slippage-limit 0.002
```

#### 2. 仅启动数据拉取器
```bash
python start_online_trading.py --data-only
```

#### 3. 仅启动策略引擎
```bash
python start_online_trading.py --strategy-only --capital 1000
```

#### 4. 测试模式（不执行实际交易）
```bash
python online_strategy_engine.py --test --capital 1000
```

### 参数说明

- `--capital`: 初始资金数量（USDT），默认1000
- `--buy-strategy`: 买入策略
  - `close`: 使用收盘价立即买入
  - `golden_ratio`: 使用黄金分割点挂单买入（推荐）
- `--slippage-limit`: 滑点限制，默认0.001 (0.1%)
  - `0.0005`: 严格控制（0.05%），适合稳定币种
  - `0.001`: 标准控制（0.1%），推荐设置
  - `0.002`: 宽松控制（0.2%），适合波动大的币种
- `--test`: 测试模式，仅检测信号不执行交易

## 📊 系统运行时间表

### 数据拉取器
- **频率**: 每小时执行一次
- **执行时间**: 每小时的0分（如 09:00, 10:00, 11:00...）

### 策略引擎
- **主策略**: 每4小时执行一次
- **执行时间**: 00:00, 04:00, 08:00, 12:00, 16:00, 20:00
- **风险管理**: 每30分钟检查一次止盈止损

## 🛡️ 安全提示

### 资金安全
1. **小额测试**: 建议先用小额资金测试系统
2. **API权限**: 确保API密钥只有现货交易权限，关闭提币权限
3. **定期检查**: 定期查看交易记录和持仓状态

### 系统监控
1. **日志监控**: 关注系统输出的日志信息
2. **异常处理**: 系统会自动重启异常的组件
3. **手动干预**: 可随时按 Ctrl+C 停止系统

## 📈 性能参数

### 回测表现（基于历史数据）
- **收益率**: 平均3-5%（10天周期）
- **胜率**: 70%左右
- **最大回撤**: 通常小于8%

### 系统资源
- **内存使用**: 约200-500MB
- **CPU使用**: 很低，主要在信号检测时短暂增加
- **网络流量**: 每小时约10-50MB（取决于币种数量）

## 🔧 故障排除

### 常见问题

1. **API连接失败**
   - 检查网络连接
   - 验证API密钥是否正确
   - 确认API权限设置

2. **数据拉取失败**
   - 检查币种列表文件是否存在
   - 验证数据目录权限
   - 检查磁盘空间

3. **交易执行失败**
   - 检查账户USDT余额
   - 验证交易权限
   - 确认最小交易金额限制

### 日志分析
系统会输出详细的运行日志，包括：
- 🚀 系统启动信息
- 📊 数据拉取状态
- 🎯 信号检测结果
- ⚡ 交易执行情况
- 🛡️ 风险管理动作

## 📞 技术支持

如果遇到问题，请检查：
1. 系统日志输出
2. API连接状态
3. 数据文件完整性
4. 账户余额和权限

---

**⚠️ 风险提示**: 
加密货币交易存在高风险，请在充分了解风险的情况下使用本系统。建议先用小额资金进行测试。
